<html>

<head>
    <script type="text/javascript" src="../scripts/three.js"></script>
    <script type="text/javascript" src="../scripts/dat.gui.min.js"></script>
    <script type="text/javascript" src="../scripts/thUtils.js"></script>
    <style type="text/css">
        #cavFrame {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>

    <div id="cavFrame"></div>
    <script type="text/javascript">
        var gui = new dat.GUI();
        var param2Ctrl = new function() {
            this.x = 0.1;
            this.y = 0.1;
            this.z = 0.1;
            this.px = 5;
            this.py = 5;
            this.pz = 5;
            this.lightColor = 0xffffff;
        };
        gui.add(param2Ctrl, "x", -5, 5);
        gui.add(param2Ctrl, "y", -5, 5);
        gui.add(param2Ctrl, "z", -5, 5);
        gui.add(param2Ctrl, "px", -20, 20);
        gui.add(param2Ctrl, "py", -20, 20);
        gui.add(param2Ctrl, "pz", -20, 20);

        util.init({
            width: 400, // window.innerWidth,
            height: 400, // window.innerHeight,
            clearColor: 0xffffff,
            el: document.getElementById("cavFrame")
        });
        util.add2Scene(new THREE.AxisHelper(20));

        var plane = new THREE.Mesh(new THREE.PlaneGeometry(60, 20, 1, 1), new THREE.MeshBasicMaterial({
            color: 0xe1e1e1
        }));
        plane.rotation.x = -0.5 * Math.PI;
        plane.position.x = 15;
        plane.position.y = 0;
        plane.position.z = 0;
        //接收阴影
        plane.receiveShadow = true;
        util.add2Scene(plane);

        //MeshBasicMaterial
        //MeshLambertMaterial
        var cube = new THREE.Mesh(new THREE.CubeGeometry(10, 10, 10), new THREE.MeshLambertMaterial({
            color: 0xff00ff //,
                //wireframe: true
        }));
        //cube.rotation.x+=0.5;
        cube.position.x = param2Ctrl.px;
        cube.position.y = param2Ctrl.py;
        cube.position.z = param2Ctrl.pz;

        cube.wireShadow = true;
        cube.castShadow = true;
        util.add2Scene(cube);

        var sphere = new THREE.Mesh(new THREE.SphereGeometry(4, 20, 20), new THREE.MeshBasicMaterial({
            color: 0x00ffff,
            wireframe: true
        }));
        sphere.position.x = 20;
        sphere.position.y = 10;
        util.add2Scene(sphere);

        //SpotLight
        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(-40, 60, -10);
        spotLight.castShadow = true;
        util.add2Scene(spotLight);

        //Enable ShadowMap  receiveShadow
        util.getRender().shadowMapEnabled = true;

        util.camera().position.x = -30;
        util.camera().position.y = 40;
        util.camera().position.z = 30;
        util.camera().lookAt(util.scene().position);

        var animate = function() {
            requestAnimationFrame(animate);
            cube.rotation.x = param2Ctrl.x;
            cube.rotation.y = param2Ctrl.y;
            cube.rotation.z = param2Ctrl.z;

            cube.position.x = param2Ctrl.px;
            cube.position.y = param2Ctrl.py;
            cube.position.z = param2Ctrl.pz;
            util.render();
        };
        animate();
    </script>
</body>

</html>